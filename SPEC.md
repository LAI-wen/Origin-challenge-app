
# 挑戰打卡 App 產品規範 (版本 2.0)

* **品牌名稱：** `8-Bit Habits`

* **產品標語：** `像素級的堅持，史詩級的成就。`

* **版本：** 2.0

* **日期：** 2025-08-13

### 1. 產品簡介 (Product Introduction)

本文件概述了「8-Bit Habits」**的開發細節。這款 App 旨在將**習慣建立**轉化為一場**復古像素風格的生存挑戰。產品核心特色為**群組競賽**，用戶可自訂規則、互相監督，並透過「**GAME OVER**」式的自動淘汰機制，強化堅持的決心與社群參與感。

### 2. 核心目標 (Core Objectives)

* **創造獨特體驗：** 透過復古像素風的視覺與遊戲化機制，讓習慣養成變得有趣且充滿回憶。

* **激發挑戰精神：** 藉由「生存競賽」與「淘汰出局」的壓力，強化用戶每日打卡的動機。

* **建立社群連結：** 讓用戶在群組中能共同挑戰、互相監督，形成強大的社群支持力量。

* **簡化管理流程：** 提供簡易的 Web 管理後台，讓「遊戲創建者」能輕鬆管理挑戰「關卡」。

### 3. 功能模組與詳細規格 (Feature Modules & Specifications)

#### **3.1. 玩家帳號與登入 (Player Account & Authentication)**

| **ID** | **功能** | **描述與規格** |
| :--- | :--- | :--- |
| **UA-1** | **Google OAuth 登入** | 玩家必須使用 Google 帳號進行登入。 |
| **UA-2** | **建立像素角色** | 首次登入時，系統會自動根據 Google 帳號資訊建立玩家資料，並分配一個預設的像素風格頭像。 |
| **UA-3** | **遊戲狀態儲存** | 支援 JWT，確保玩家登入狀態持久化，無須每次進入 App 都重新登入。 |

#### **3.2. 挑戰關卡系統 (Challenge Level System)**

| **ID** | **功能** | **描述與規格** |
| :--- | :--- | :--- |
| **CG-1** | **創建關卡** | 「遊戲創建者」可設定以下資訊：<br> - 關卡名稱與描述<br> - 遊戲規則（每日打卡時段、連續漏打卡天數上限）<br> - 系統自動生成**獨特的邀請碼**（如：8-Bit 編碼）。 |
| **CG-2** | **加入關卡** | 玩家需輸入「關卡邀請碼」才能加入遊戲。 |
| **CG-3** | **玩家身份組與權限** | 關卡內有三種身份：<br> - **創建者**：擁有編輯關卡規則與「踢出」玩家的權限。<br> - **一般玩家**：能進行打卡、查看關卡狀態與其他玩家的打卡紀錄。<br> - **觀眾**：能查看所有玩家的打卡紀錄，但不能打卡。<br> |
| **CG-4** | **關卡隱私設定** | 創建者可設定關卡內**打卡內容的顯示權限**：<br> - `公開 (Public)`：所有成員（包含玩家與觀眾）皆可查看。<br> - `私人 (Private)`：僅限本人與創建者可查看。<br> - `創建者限定 (CreatorOnly)`：僅限創建者可查看。<br> |
| **CG-5** | **關卡狀態** | 關卡狀態包含「進行中」與「已破關」。當挑戰結束時，關卡會自動鎖定，無法再進行打卡。 |

#### **3.3. 任務回報機制 (Check-in Mechanism)**

| **ID** | **功能** | **描述與規格** |
| :--- | :--- | :--- |
| **CI-1** | **每日任務限制** | 每位玩家每日在每個關卡只能「回報」一次任務。 |
| **CI-2** | **任務時段** | 必須在關卡設定的每日時段內完成回報，超過時間將視為「漏打卡」。 |
| **CI-3** | **回報內容類型** | 支援三種回報類型：<br> - **文字內容**：必須包含文字內容，並設定字數限制。<br> - **單純打勾**：僅需點擊按鈕，不需輸入任何內容。<br> - **圖片**：可上傳圖片作為回報。 |
| **CI-4** | **圖片處理** | 玩家上傳的**清晰圖片**將存在**本地端**，而伺服器端將儲存**壓縮過的像素風格版本**。此像素圖作為關卡內展示與預覽用，維持品牌風格。 |
| **CI-5** | **狀態顯示** | 在關卡詳情頁面與「冒險日誌」，應以像素風格圖標顯示玩家的「回報狀態」。<br> - **倒數計時**：顯示當天剩餘打卡時間。<br> - **視覺回饋**：若已過打卡時間，倒數計時會變為**紅色**；若剩餘不到 1 小時，邊框會**閃爍**，強化緊迫感。 |
| **CI-6** | **未來擴充** | 預留功能：支援影片連結上傳，並在伺服器端自動截取預覽圖並轉為像素風格。 |

#### **3.4. 規則與淘汰系統 (Rules & Elimination System)**

| **ID** | **功能** | **描述與規格** |
| :--- | :--- | :--- |
| **RE-1** | **自動淘汰** | 系統將在每日結束後執行排程，檢查所有進行中的關卡。若玩家**連續漏打卡天數**超過關卡規則設定上限，該玩家將會被宣告 **「GAME OVER」**並被自動淘汰。 |
| **RE-2** | **關卡結算** | 挑戰結束時，系統會自動判定並顯示「通關玩家名單」。 |
| **RE-3** | **成就徽章** | 挑戰結束後，根據玩家的表現發放像素風格的成就徽章，例如：「完美通關」（從未漏打卡）、「倖存者」（在淘汰邊緣通關）。 |

#### **3.5. 通知與排程 (Notifications & Scheduling)**

| **ID** | **功能** | **描述與規格** |
| :--- | :--- | :--- |
| **NS-1** | **排程邏輯** | 每日自動排程，負責：<br> - 判定當日未打卡者。<br> - 判定並自動淘汰連續未打卡的玩家。<br> - 在挑戰結束時，發放成就徽章並結算。 |
| **NS-2** | **Email 通知** | 提供玩家可選的通知服務：<br> - **每日任務提醒**： 提醒玩家回報任務，每日最多發送一次。<br> - **淘汰通知**： 告知玩家已被淘汰。對於**小眾玩家**（人數較少）的關卡，系統會自動寄信給關卡內所有其他「一般玩家」，通知其某位隊友已被淘汰。 |
| **NS-3** | **未來擴充** | 預留功能：整合推播通知服務，以提供更即時的提醒。 |

#### **3.6. 像素介面 (Pixelated UI)**

| **ID** | **頁面名稱** | **描述與規格** |
| :--- | :--- | :--- |
| **UI-1** | **多語系支援** | 所有介面、文字和提示訊息需支援中文（繁體）和英文。 |
| **UI-2** | **登入/角色選擇頁** | 包含一個簡潔的 Google 登入按鈕，並可讓用戶選擇一個像素小人作為角色。 |
| **UI-3** | **關卡列表頁** | 顯示玩家所有加入的關卡，並有「創建新關卡」和「加入關卡」的按鈕。 |
| **UI-4** | **關卡詳情頁** | 顯示關卡名稱、規則、玩家列表及打卡狀態。介面充滿街機遊戲風格，頁面底部包含回報輸入框與提交按鈕。 |
| **UI-5** | **冒險日誌** | 顯示玩家所有關卡的今日任務進度，以像素風格的進度條呈現。 |
| **UI-6** | **玩家紀錄頁面** | **新增**：在「關卡詳情頁」點選特定玩家或自己，可進入此頁面。頁面會顯示該玩家在關卡中直到目前為止的所有打卡內容。右上角提供**匯出按鈕**，支援匯出為不同格式（如 Markdown、PDF）。「冒險日誌」頁面也提供入口進入此畫面。 |
| **UI-7** | **未來擴充** | 預留功能：規劃「探索」頁面與「玩家檔案」頁面。 |

#### **3.7. 簡易 Web 管理後台 (Game Admin Panel)**

| **ID** | **功能** | **描述與規格** |
| :--- | :--- | :--- |
| **AD-1** | **功能範圍** | 僅限「遊戲創建者」登入，用於瀏覽與管理自己建立的關卡。 |
| **AD-2** | **權限** | 創建者可在此後台：<br> - 查看所有玩家的任務進度。<br> - 編輯關卡規則。<br> - **新增**：可編輯關卡內成員的權限（玩家/觀眾），以及將成員移除。 |
| **AD-3** | **響應式設計** | 採用 RWD，確保在手機、平板與電腦上都能正常瀏覽。 |

#### **3.8. Keep 個人成長筆記本 (未來擴充)**

| **ID** | **功能** | **描述與規格** |
| :--- | :--- | :--- |
| **Keep-1** | **核心功能** | 獨立於挑戰關卡，提供專屬頁面讓玩家建立、查看、編輯個人筆記、清單與待辦事項，以遊戲日誌形式呈現。 |
| **Keep-2** | **整合功能** | 允許玩家將任務回報內容一鍵儲存至個人日誌，或從日誌複製內容至任務回報欄位。 |
| **Keep-3** | **未來擴充** | 預留功能：支援標籤與顏色分類，以及設定提醒功能。 |

### 4. 數據模型與 API 概要 (Data Model & API Outline)

#### **4.1. 資料模型設計 (Data Model Design)**

*此資料模型已調整為更具彈性的設計，可支援新定義的身份組與隱私設定。*

```json
// Player (原 User)
{
  "id": "UUID",
  "email": "String",
  "name": "String",
  "avatarUrl": "String",
  "language": "String",
  "createdAt": "DateTime"
}

// Level (原 Group)
{
  "id": "UUID",
  "name": "String",
  "description": "String",
  "inviteCode": "String",
  "ownerId": "UUID",
  "rule": {
    "startTime": "String (e.g., '05:00')",
    "endTime": "String (e.g., '23:00')",
    "maxMissedDays": "Number"
  },
  "settings": { // 新增 - 用於儲存關卡的細節設定
    "checkinContentVisibility": "String ('public' | 'private' | 'creatorOnly')"
  },
  "isActive": "Boolean",
  "startDate": "Date",
  "endDate": "Date"
}

// LevelMember (原 GroupMember)
{
  "id": "UUID",
  "playerId": "UUID",
  "levelId": "UUID",
  "joinedAt": "DateTime",
  "status": "String ('active' | 'eliminated')",
  "missedDays": "Number",
  "role": "String ('creator' | 'player' | 'audience')" // 新增 - 儲存玩家在關卡中的身份
}

// CheckIn
{
  "id": "UUID",
  "playerId": "UUID",
  "levelId": "UUID",
  "type": "String ('text' | 'image' | 'checkmark')", // 新增 - 打卡類型
  "content": "String",
  "imagePixelUrl": "String", // 新增 - 像素化圖片的 URL
  "createdAt": "DateTime"
}

// Keep Note (未來擴充)
{
  "id": "UUID",
  "playerId": "UUID",
  "content": "String",
  "tags": "String[]",
  "color": "String",
  "createdAt": "DateTime"
}
````

#### **4.2. API 設計概要 (API Design Outline)**

*此部分 API 描述已根據新的功能進行調整。*

| **類型** | **端點 (Endpoint)** | **說明 (Description)** |
| :--- | :--- | :--- |
| **Auth** | `POST /auth/google` | 處理 Google Token 登入，並回傳 JWT。 |
| **Level** | `POST /levels` | 創建一個新關卡，包含隱私設定。 |
| | `GET /levels` | 取得玩家所有關卡列表。 |
| | `POST /levels/:id/join` | 使用邀請碼加入指定關卡。 |
| | `GET /levels/:id` | 取得關卡詳細資訊，會根據成員身份組與隱私設定顯示資料。 |
| | `PUT /levels/:id/rules` | 編輯關卡規則（限創建者）。 |
| | `PUT /levels/:id/members/:memberId/role` | 編輯關卡成員的身份組（限創建者）。 |
| **Check-In** | `POST /levels/:id/checkin` | 提交今日任務回報，包含內容類型與附件。 |
| | `GET /levels/:id/checkins` | 取得關卡內所有玩家的打卡紀錄。 |
| | `GET /levels/:id/checkins/today` | 取得關卡內玩家今日任務狀態。 |
| | `GET /levels/:id/checkins/:playerId` | 取得指定玩家在該關卡的所有打卡紀錄。 |
| **Admin** | `POST /cron/evaluate` | 內部排程觸發，用於執行每日結算與淘汰邏輯。 |

### 5\. 開發時程與完成標準 (Timeline & Done Criteria)

#### **5.1. 開發時程 (Development Timeline)**

| **時程** | **階段** | **主要任務** |
| :--- | :--- | :--- |
| **第 1 週** | **基礎架構** | 專案初始化、Google OAuth 登入、多語系設定、**可擴充資料模型設計**。 |
| **第 2 週** | **核心功能** | 創建/加入關卡、**新增權限與隱私設定**、**多類型打卡**、前端介面開發。 |
| **第 3 週** | **排程與管理** | 自動淘汰排程、Email 通知、簡易 Web 管理後台。 |
| **第 4 週** | **測試與部署** | 全面整合測試、**UI 互動效果實作**、部署規劃、App 上架準備。 |

#### **5.2. 完成標準 (Done Criteria)**

| **模組** | **完成標準** |
| :--- | :--- |
| **登入** | 透過 Google OAuth 成功登入，並建立使用者資料。 |
| **關卡** | 可正常創建、加入關卡，且**身份組與隱私權限系統運作正確**。 |
| **打卡** | **多類型打卡**（文字/圖片/打勾）正常運作，**圖片像素化**處理成功。 |
| **淘汰** | 自動排程正確執行，能準確淘汰連續未打卡的成員。 |
| **多語系** | App UI 與 Email 通知可正確切換中/英文。 |
| **Web 後台** | 創建者可登入後台，並正常編輯規則、**成員權限**與查看進度。 |
| **UI/UX** | **打卡倒數計時**功能正常，**玩家紀錄頁面**可正確顯示與匯出。 |
| **測試** | 核心功能通過測試，並完成壓力測試與部署準備。 |

### 6\. 技術架構與維運 (Technical Architecture & Operations)

  * **前端 (App)：** React Native (Expo) + UI Library (NativeBase/Tailwind)

  * **後端：** Node.js + Express、PostgreSQL (搭配 Prisma ORM)

  * **Web 後台：** Next.js / React App (與後端共用 API)

  * **排程：** node-cron (後端排程)

  * **部署：** 採用 Docker 進行容器化管理，並使用 PM2 確保 Node.js 服務穩定。

  * **監控與日誌：** 整合 Sentry 或 Logtail 進行錯誤追蹤。

  * **資安：** 所有敏感資訊（如 API 金鑰）皆以環境變數 (`.env`) 方式集中管理，並嚴格排除在 Git 版本控制外。

### 7\. 注意事項 (Important Notes)

  * **時區處理：** 伺服器端所有時間都應以 **UTC 格式**儲存，並在前端依據用戶所在時區進行轉換顯示。

  * **Email 寄送：** 為避免濫發，Email 提醒通知應確保同一用戶每日最多寄送一次。

  * **排程時間：** 每日結算與淘汰排程應設定在當日結束後執行（例如 23:59 或 00:00 UTC），以確保判定的準確性。

