
# 挑戰打卡 App 產品規範 (版本 2.0)

* **品牌名稱：** `8-Bit Habits`

* **產品標語：** `像素級的堅持，史詩級的成就。`

* **版本：** 2.0

* **日期：** 2025-08-13

### 1. 產品簡介 (Product Introduction)

本文件概述了「8-Bit Habits」**的開發細節。這款 App 旨在將**習慣建立**轉化為一場**復古像素風格的生存挑戰。產品核心特色為**群組競賽**，用戶可自訂規則、互相監督，並透過「**GAME OVER**」式的自動淘汰機制，強化堅持的決心與社群參與感。

### 2. 核心目標 (Core Objectives)

* **創造獨特體驗：** 透過復古像素風的視覺與遊戲化機制，讓習慣養成變得有趣且充滿回憶。

* **激發挑戰精神：** 藉由「生存競賽」與「淘汰出局」的壓力，強化用戶每日打卡的動機。

* **建立社群連結：** 讓用戶在群組中能共同挑戰、互相監督，形成強大的社群支持力量。

* **簡化管理流程：** 提供簡易的 Web 管理後台，讓「遊戲創建者」能輕鬆管理挑戰「關卡」。

### 3. 功能模組與詳細規格 (Feature Modules & Specifications)

#### **3.1. 玩家帳號與登入 (Player Account & Authentication)**

| **ID** | **功能** | **描述與規格** |
| :--- | :--- | :--- |
| **UA-1** | **Google OAuth 登入** | 玩家必須使用 Google 帳號進行登入。 |
| **UA-2** | **建立像素角色** | 首次登入時，系統會自動根據 Google 帳號資訊建立玩家資料，並分配一個預設的像素風格頭像。 |
| **UA-3** | **遊戲狀態儲存** | 支援 JWT，確保玩家登入狀態持久化，無須每次進入 App 都重新登入。 |

#### **3.2. 密室挑戰系統 (Escape Room System)**

| **ID** | **功能** | **描述與規格** |
| :--- | :--- | :--- |
| **ER-1** | **開啟房間** | 「房間主人」可設定以下資訊：<br> - 房間名稱與挑戰目標<br> - 房間主題（經典書房/健身房/創作工坊/冥想禪室）<br> - 逃脫規則（每日打卡時段、連續漏打卡天數上限）<br> - 系統自動生成**獨特的房間邀請碼**（如：8位元編碼）。 |
| **ER-2** | **進入房間** | 玩家需輸入「房間邀請碼」才能進入被困的房間。一旦進入，房間即上鎖。 |
| **ER-3** | **房間身份與權限** | 房間內有三種身份：<br> - **房間主人**：擁有編輯房間規則與「救出被困玩家」的權限。<br> - **被困玩家**：需要完成每日任務來累積逃脫進度。<br> - **觀察者**：能查看房間狀態和玩家進度，但不參與挑戰。<br> |
| **ER-4** | **房間隱私設定** | 房間主人可設定**任務紀錄的可見度**：<br> - `公開展示`：所有成員都能看到彼此的任務完成情況。<br> - `私人模式`：僅限本人與房間主人可查看個人紀錄。<br> - `主人監控`：只有房間主人能查看所有玩家紀錄。<br> |
| **ER-5** | **房間狀態** | 房間狀態包含：<br> - **🔒 進行中**：房間上鎖，玩家努力逃脫中<br> - **🗝️ 已破關**：所有玩家成功逃脫，房間變為紀念碑<br> - **⚠️ 挑戰失敗**：超過期限或違反規則，房間進入失敗狀態 |
| **ER-6** | **逃脱進度系統** | 每個房間顯示視覺化的逃脫進度：<br> - 進度條顯示完成百分比 (0-100%)<br> - 房間場景隨進度逐漸「解鎖」<br> - 達成里程碑時獲得房間內的道具和線索 |
| **ER-7** | **房間主題與收集** | 完成房間後獲得：<br> - 房間紀念碑（永久展示在畫廊）<br> - 主題裝飾品（可用於個人像素小屋）<br> - 成就徽章和特殊稱號<br> - 解鎖新的房間主題 |

#### **3.3. 逃脫任務系統 (Daily Escape Tasks)**

| **ID** | **功能** | **描述與規格** |
| :--- | :--- | :--- |
| **ET-1** | **每日逃脫嘗試** | 每位被困玩家每日在每個房間只能進行一次「逃脫嘗試」(打卡)。 |
| **ET-2** | **逃脫時段限制** | 必須在房間設定的每日時段內完成逃脫嘗試，超過時間將錯失當日逃脫機會。 |
| **ET-3** | **逃脫證明類型** | 支援三種逃脫證明方式：<br> - **任務日記**：撰寫文字記錄當日完成的挑戰內容。<br> - **完成確認**：點擊「已完成任務」按鈕進行簡單確認。<br> - **成果照片**：上傳圖片作為完成任務的視覺證明。 |
| **ET-4** | **照片像素化處理** | 玩家上傳的**原始照片**儲存於**本地端**，伺服器自動轉換為**8位元像素風格版本**。像素化照片用於房間內展示，維持遊戲美學風格。 |
| **ET-5** | **房間狀態顯示** | 在工作室(房間詳情)頁面顯示即時逃脫狀態：<br> - **逃脫倒數**：顯示當日剩餘嘗試時間。<br> - **緊急警告**：時間不足1小時時，房間邊框閃爍紅光。<br> - **進度條**：視覺化顯示距離逃脫成功的完成度。 |
| **ET-6** | **未來擴充** | 預留功能：支援影片連結上傳作為逃脫證明，自動截取關鍵幀並轉為像素風格縮圖。 |

#### **3.4. 房間規則與失敗機制 (Room Rules & Failure System)**

| **ID** | **功能** | **描述與規格** |
| :--- | :--- | :--- |
| **RF-1** | **自動困住** | 系統每日檢查所有上鎖房間。若玩家**連續錯失逃脫機會天數**超過房間規則設定上限，該玩家將被宣告 **「永久困在房間」**並失去逃脫資格。 |
| **RF-2** | **房間解鎖** | 挑戰期結束或所有玩家達成逃脫條件時，房間自動解鎖並顯示「成功逃脫者名單」。 |
| **RF-3** | **逃脫徽章** | 房間挑戰結束後，根據玩家表現發放像素風格徽章：「完美逃脫者」（從未錯失機會）、「最後倖存者」（在困住邊緣成功逃脫）。 |

#### **3.5. 通知與排程 (Notifications & Scheduling)**

| **ID** | **功能** | **描述與規格** |
| :--- | :--- | :--- |
| **NS-1** | **房間排程** | 每日自動排程，負責：<br> - 檢測各房間內錯失逃脫嘗試的玩家。<br> - 自動困住連續錯失機會的玩家。<br> - 房間挑戰結束時，發放逃脫徽章並解鎖房間。 |
| **NS-2** | **Email 通知** | 提供玩家可選的通知服務：<br> - **逃脫提醒**： 提醒玩家進行每日逃脫嘗試，每日最多發送一次。<br> - **困住通知**： 告知玩家已被永久困在房間中。對於**小型房間**（人數較少），系統會自動通知房間內其他玩家有隊友被困住的消息。 |
| **NS-3** | **未來擴充** | 預留功能：整合推播通知服務，提供更即時的房間狀態提醒。 |

#### **3.6. 像素介面 (Pixelated UI)**

| **ID** | **頁面名稱** | **描述與規格** |
| :--- | :--- | :--- |
| **UI-1** | **多語系支援** | 所有介面、文字和提示訊息需支援中文（繁體）和英文。 |
| **UI-2** | **登入/角色選擇頁** | 包含一個簡潔的 Google 登入按鈕，並可讓用戶選擇一個像素小人作為角色。 |
| **UI-3** | **畫廊頁面 (房間列表)** | 顯示玩家所有房間，包含進行中和已完成的房間。空狀態時顯示大大的「+ 開啟你的第一個房間」按鈕。 |
| **UI-4** | **工作室頁面 (房間詳情)** | 沈浸式房間視圖，顯示房間主題、逃脫進度、被困玩家狀態。底部有逃脫嘗試按鈕，設計為房間互動元素（如：轉動門把、按下開關）。 |
| **UI-5** | **今日任務面板** | 顯示玩家在所有房間中的當日逃脫任務進度，用像素風格進度條和房間縮圖呈現。 |
| **UI-6** | **逃脫記錄頁面** | 在工作室點選玩家可進入此頁。顯示該玩家在房間中的所有逃脫嘗試記錄。右上角提供**匯出按鈕**，支援匯出逃脫日記（Markdown、PDF格式）。 |
| **UI-7** | **個人像素小屋** | **新增**：展示玩家收集的房間紀念品、解鎖的主題和成就徽章。可從這裡進入各房間或查看個人統計。 |

#### **3.7. 房間主人控制台 (Room Master Panel)**

| **ID** | **功能** | **描述與規格** |
| :--- | :--- | :--- |
| **RM-1** | **功能範圍** | 僅限「房間主人」登入，用於監控與管理自己開啟的房間。 |
| **RM-2** | **主人權限** | 房間主人可在控制台：<br> - 即時監控所有被困玩家的逃脫進度。<br> - 調整房間規則和逃脫條件。<br> - **新增**：管理房間成員權限（被困玩家/觀察者），以及救出（移除）特定成員。 |
| **RM-3** | **響應式設計** | 採用 RWD，確保在手機、平板與電腦上都能正常使用控制台。 |

#### **3.8. Keep 個人成長筆記本 (未來擴充)**

| **ID** | **功能** | **描述與規格** |
| :--- | :--- | :--- |
| **Keep-1** | **核心功能** | 獨立於挑戰關卡，提供專屬頁面讓玩家建立、查看、編輯個人筆記、清單與待辦事項，以遊戲日誌形式呈現。 |
| **Keep-2** | **整合功能** | 允許玩家將任務回報內容一鍵儲存至個人日誌，或從日誌複製內容至任務回報欄位。 |
| **Keep-3** | **未來擴充** | 預留功能：支援標籤與顏色分類，以及設定提醒功能。 |

### 4. 數據模型與 API 概要 (Data Model & API Outline)

#### **4.1. 資料模型設計 (Data Model Design)**

*此資料模型已調整為更具彈性的設計，可支援新定義的身份組與隱私設定。*

```json
// Player (原 User)
{
  "id": "UUID",
  "email": "String",
  "name": "String",
  "avatarUrl": "String",
  "language": "String",
  "createdAt": "DateTime"
}

// Level (原 Group)
{
  "id": "UUID",
  "name": "String",
  "description": "String",
  "inviteCode": "String",
  "ownerId": "UUID",
  "rule": {
    "startTime": "String (e.g., '05:00')",
    "endTime": "String (e.g., '23:00')",
    "maxMissedDays": "Number"
  },
  "settings": { // 新增 - 用於儲存關卡的細節設定
    "checkinContentVisibility": "String ('public' | 'private' | 'creatorOnly')"
  },
  "isActive": "Boolean",
  "startDate": "Date",
  "endDate": "Date"
}

// LevelMember (原 GroupMember)
{
  "id": "UUID",
  "playerId": "UUID",
  "levelId": "UUID",
  "joinedAt": "DateTime",
  "status": "String ('active' | 'eliminated')",
  "missedDays": "Number",
  "role": "String ('creator' | 'player' | 'audience')" // 新增 - 儲存玩家在關卡中的身份
}

// CheckIn
{
  "id": "UUID",
  "playerId": "UUID",
  "levelId": "UUID",
  "type": "String ('text' | 'image' | 'checkmark')", // 新增 - 打卡類型
  "content": "String",
  "imagePixelUrl": "String", // 新增 - 像素化圖片的 URL
  "createdAt": "DateTime"
}

// Keep Note (未來擴充)
{
  "id": "UUID",
  "playerId": "UUID",
  "content": "String",
  "tags": "String[]",
  "color": "String",
  "createdAt": "DateTime"
}
````

#### **4.2. API 設計概要 (API Design Outline)**

*此部分 API 描述已根據新的功能進行調整。*

| **類型** | **端點 (Endpoint)** | **說明 (Description)** |
| :--- | :--- | :--- |
| **Auth** | `POST /auth/google` | 處理 Google Token 登入，並回傳 JWT。 |
| **Level** | `POST /levels` | 創建一個新關卡，包含隱私設定。 |
| | `GET /levels` | 取得玩家所有關卡列表。 |
| | `POST /levels/:id/join` | 使用邀請碼加入指定關卡。 |
| | `GET /levels/:id` | 取得關卡詳細資訊，會根據成員身份組與隱私設定顯示資料。 |
| | `PUT /levels/:id/rules` | 編輯關卡規則（限創建者）。 |
| | `PUT /levels/:id/members/:memberId/role` | 編輯關卡成員的身份組（限創建者）。 |
| **Check-In** | `POST /levels/:id/checkin` | 提交今日任務回報，包含內容類型與附件。 |
| | `GET /levels/:id/checkins` | 取得關卡內所有玩家的打卡紀錄。 |
| | `GET /levels/:id/checkins/today` | 取得關卡內玩家今日任務狀態。 |
| | `GET /levels/:id/checkins/:playerId` | 取得指定玩家在該關卡的所有打卡紀錄。 |
| **Admin** | `POST /cron/evaluate` | 內部排程觸發，用於執行每日結算與淘汰邏輯。 |

### 5\. 開發時程與完成標準 (Timeline & Done Criteria)

#### **5.1. 開發時程 (Development Timeline)**

| **時程** | **階段** | **主要任務** |
| :--- | :--- | :--- |
| **第 1 週** | **基礎架構** | 專案初始化、Google OAuth 登入、多語系設定、**可擴充資料模型設計**。 |
| **第 2 週** | **核心功能** | 創建/加入關卡、**新增權限與隱私設定**、**多類型打卡**、前端介面開發。 |
| **第 3 週** | **排程與管理** | 自動淘汰排程、Email 通知、簡易 Web 管理後台。 |
| **第 4 週** | **測試與部署** | 全面整合測試、**UI 互動效果實作**、部署規劃、App 上架準備。 |

#### **5.2. 完成標準 (Done Criteria)**

| **模組** | **完成標準** |
| :--- | :--- |
| **登入** | 透過 Google OAuth 成功登入，並建立使用者資料。 |
| **關卡** | 可正常創建、加入關卡，且**身份組與隱私權限系統運作正確**。 |
| **打卡** | **多類型打卡**（文字/圖片/打勾）正常運作，**圖片像素化**處理成功。 |
| **淘汰** | 自動排程正確執行，能準確淘汰連續未打卡的成員。 |
| **多語系** | App UI 與 Email 通知可正確切換中/英文。 |
| **Web 後台** | 創建者可登入後台，並正常編輯規則、**成員權限**與查看進度。 |
| **UI/UX** | **打卡倒數計時**功能正常，**玩家紀錄頁面**可正確顯示與匯出。 |
| **測試** | 核心功能通過測試，並完成壓力測試與部署準備。 |

### 6\. 技術架構與維運 (Technical Architecture & Operations)

  * **前端 (App)：** React Native (Expo) + UI Library (NativeBase/Tailwind)

  * **後端：** Node.js + Express、PostgreSQL (搭配 Prisma ORM)

  * **Web 後台：** Next.js / React App (與後端共用 API)

  * **排程：** node-cron (後端排程)

  * **部署：** 採用 Docker 進行容器化管理，並使用 PM2 確保 Node.js 服務穩定。

  * **監控與日誌：** 整合 Sentry 或 Logtail 進行錯誤追蹤。

  * **資安：** 所有敏感資訊（如 API 金鑰）皆以環境變數 (`.env`) 方式集中管理，並嚴格排除在 Git 版本控制外。

### 7\. 注意事項 (Important Notes)

  * **時區處理：** 伺服器端所有時間都應以 **UTC 格式**儲存，並在前端依據用戶所在時區進行轉換顯示。

  * **Email 寄送：** 為避免濫發，Email 提醒通知應確保同一用戶每日最多寄送一次。

  * **排程時間：** 每日結算與淘汰排程應設定在當日結束後執行（例如 23:59 或 00:00 UTC），以確保判定的準確性。

